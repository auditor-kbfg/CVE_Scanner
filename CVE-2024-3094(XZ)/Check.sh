    #!/bin/bash
    # https://nvd.nist.gov/vuln/detail/CVE-2024-3094

    # Original is https://github.com/FabioBaroni/CVE-2024-3094-checker/blob/main/CVE-2024-3094-checker.sh
	#But it has no yum checker
	#i add checker script in yum 
	#JongChan Park in KBBANK @KBFG


    # Detect package manager
    if command -v apt-get &>/dev/null; then
        PKG_MANAGER="apt-get"
    elif command -v yum &>/dev/null; then
        PKG_MANAGER="yum"
    elif command -v zypper &>/dev/null; then
        PKG_MANAGER="zypper"
    else
        echo "Unsupported package manager. Exiting."
        exit 1
    fi

    if [ "$PKG_MANAGER" = "zypper" ]; then

        version=$(rpm -q xz)
        if [[ $version =~ (5\.6\.(0|1)) && ! $version =~ revertto ]]; then
            echo "Vulnerable version of xz-utils detected: $version"
        
            if lsb_release -d | grep -q "Tumbleweed"; then
                echo "OpenSuse recommends openSUSE Tumbleweed users where SSH is exposed to the internet to make a fresh installation of the system and change credentials, as itâ€™s unknown if the backdoor has been exploited."
                echo "Due to the sophisticated nature of the backdoor an on-system detection of a breach is likely not possible."
                echo "Also rotation of any credentials that could have been fetched from the system is highly recommended."
            fi
        else
            echo "Your OpenSuse installation is safe: $version"
        fi
    elif [ "$PKG_MANAGER" = "apt-get" ]; then
        version=$(dpkg -l | grep "xz-utils" | awk '{print $3}')
        if [[ "$version" == *"5.6.0"* || "$version" == *"5.6.1"* ]]; then
            echo "Vulnerable version of xz-utils detected: $version"
        else
            echo "You appear to be safe: $version"
        fi
    elif [ "$PKG_MANAGER" = "yum" ]; then
        version=$(yum list installed xz)
        if [[ "$version" == *"5.6.0"* || "$version" == *"5.6.1"* ]]; then
            echo "Vulnerable version of xz-utils detected: $version"
        else
            echo "You appear to be safe: $version"
        fi
    fi